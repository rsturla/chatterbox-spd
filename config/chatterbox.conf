# Chatterbox TTS module configuration for Speech Dispatcher
#
# This configuration uses the Generic output module to interface with
# the Chatterbox TTS daemon.
#
# Installation:
#   1. Copy this file to /etc/speech-dispatcher/modules/chatterbox.conf
#   2. Add to /etc/speech-dispatcher/speechd.conf:
#      AddModule "chatterbox" "sd_generic" "chatterbox.conf"
#   3. Start the chatterbox-tts-daemon service
#   4. Restart speech-dispatcher

# Debug logging (set to 1 for debugging)
# Debug 0

# The command to execute for synthesis
# $DATA contains the text to speak
# Environment variables control voice selection and parameters
GenericExecuteSynth \
"export CHATTERBOX_VOICE=\"$VOICE\"; \
 export CHATTERBOX_RATE=\"$RATE\"; \
 export CHATTERBOX_PITCH=\"$PITCH\"; \
 echo \"$DATA\" | /usr/local/bin/chatterbox-tts-client"

# Alternative: Use direct text argument (may have quoting issues with special chars)
# GenericExecuteSynth \
# "/usr/local/bin/chatterbox-tts-client --voice \"$VOICE\" --text \"$DATA\""

# Command to stop speech (kills the audio player)
GenericCmdStop "pkill -f 'aplay.*chatterbox\\|paplay.*chatterbox\\|pw-play.*chatterbox'"

# Check that the client script exists
GenericCmdDependency "/usr/local/bin/chatterbox-tts-client"

# Rate/pitch handling
# Chatterbox doesn't directly support rate/pitch, but we pass them as env vars
# for potential future use or wrapper handling
GenericRateAdd 0
GenericPitchAdd 0
GenericVolumeAdd 0

# Rate range for speech-dispatcher (-100 to 100 mapped to internal values)
GenericRateMultiply 1

# Language to voice mapping
# Format: AddVoice "language" "variant" "voice_name"
#
# The voice_name should match a .wav file in ~/.cache/chatterbox-spd/voices/
# For example, "alice" maps to ~/.cache/chatterbox-spd/voices/alice.wav
#
# "default" uses Chatterbox's built-in voice without cloning

# Default voice (no voice cloning)
AddVoice "en" "MALE1" "default"
AddVoice "en" "FEMALE1" "default"

# Uncomment and modify these to add custom cloned voices:
# AddVoice "en" "MALE2" "john"      # Uses voices/john.wav
# AddVoice "en" "FEMALE2" "sarah"   # Uses voices/sarah.wav

# Multilingual voices (requires ChatterboxMultilingualTTS in daemon)
# AddVoice "fr" "MALE1" "default"
# AddVoice "de" "MALE1" "default"
# AddVoice "es" "MALE1" "default"
# AddVoice "it" "MALE1" "default"
# AddVoice "pt" "MALE1" "default"
# AddVoice "ru" "MALE1" "default"
# AddVoice "zh" "MALE1" "default"
# AddVoice "ja" "MALE1" "default"
# AddVoice "ko" "MALE1" "default"

# Sound output method - we handle audio playback in the client
GenericSoundOutputMethod "external"

# Maximum text length (Chatterbox handles long text well)
GenericMaxChunkLength 10000

# Character replacements (optional - clean up text before synthesis)
# GenericReplace "__" "_"
